<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MCQ Ultra-Pro V20</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#2563eb">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:,">
</head>

<body class="theme-light">
<div id="toastContainer" class="toast-container"></div>

<div class="app" id="appRoot">

  <!-- TOP BAR -->
  <header class="top-bar">
    <div class="brand-area">
      <div class="logo">üíé</div>
      <div>
        <h1>MCQ Ultra-Pro <span class="ver">V20</span></h1>
        <div class="xp-wrapper">
          <span id="userRank">Intern</span> ‚Ä¢ 
          <span id="userXP">0</span> XP ‚Ä¢ 
          üî• <span id="streakCount">0</span>
        </div>
      </div>
    </div>

    <div class="chips">
      <span class="chip" id="dbStatus">DB: Init...</span>
      <span class="chip chip-sync" id="syncStatus">Cloud: Check</span>
      <button id="btnHeaderBackup" class="chip header-btn">‚òÅÔ∏è Backup</button>
      <button id="themeToggle" class="chip header-btn">üåó Theme</button>
    </div>
  </header>

  <!-- NAV -->
  <nav class="tabs">
    <button class="tab-button active" data-tab="home">Practice</button>
    <button class="tab-button" data-tab="all">Library</button>
    <button class="tab-button" data-tab="flashcards">Flashcards</button>
    <button class="tab-button" data-tab="exam">Exam</button>
    <button class="tab-button" data-tab="dashboard">Stats</button>
    <button class="tab-button" data-tab="settings">Settings</button>
    <button class="tab-button" data-tab="sessions">Sessions</button>
    <button class="tab-button" data-tab="backups">Question Backups</button>
  </nav>

  <!-- MAIN -->
  <main class="tab-container">

    <!-- PRACTICE -->
    <section id="tab-home" class="tab-content active">
      <div class="card main-layout">

        <!-- CENTER COLUMN: QUESTION -->
        <div class="col-main">
          <!-- Controls -->
          <div class="row-controls">
            <select id="modeSelect" class="std-select">
              <option value="due">üß† Smart Review</option>
              <option value="new">üÜï New Only</option>
              <option value="wrong">‚ùå Mistakes</option>
              <option value="maintain">üîß Maintenance</option>
              <option value="flagged">üö© Flagged</option>
              <option value="chapter">üìÇ By Chapter</option>
              <option value="all">üîÄ Random All</option>
            </select>

            <div id="chapterBox" style="display:none;">
              <select id="chapterSelect" class="std-select chapter-list"></select>
            </div>

            <button id="btnRefreshPractice" class="refresh-btn">‚Üª Apply</button>

            <label class="check-label">
              <input type="checkbox" id="prefSkipSolved"> Skip Mastered
            </label>

            <button id="btnFocusMode" class="pill-btn">üßò Focus</button>
          </div>

          <!-- Question Info -->
          <div id="qInfoBar" class="info-bar hidden">
            <span id="qInfoID"></span> ‚Ä¢ 
            <span id="qInfoChapter"></span> ‚Ä¢
            <span id="qInfoStats"></span> ‚Ä¢
            <span id="qInfoDate"></span>
          </div>

          <!-- Question Panel -->
          <div id="questionPanel" class="question-panel">
            <div class="muted" style="text-align:center; padding:20px;">
              Loading Engine‚Ä¶
            </div>
          </div>

          <!-- Feedback -->
          <div id="feedbackPanel" class="feedback-panel hidden"></div>

          <!-- Tools Row -->
          <div class="tools-row">
             <div id="searchTools" class="search-tools"></div>
             <button class="ghost-btn" id="btnFlag">Flag ‚öê</button>
             <button class="ghost-btn warning-text" id="btnMaintain">üîß Report</button>
          </div>

          <!-- Maintenance Modal/Box -->
          <div id="maintBox" class="maint-box hidden">
             <strong style="color:var(--danger)">üîß Report Issue</strong>
             <textarea id="maintNote" class="maint-input" placeholder="Describe error..."></textarea>
             <button id="btnSaveMaint" class="tiny-btn">Save Report</button>
          </div>

          <!-- Notes -->
          <div class="notes-container">
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
               <label class="small-label">Notes üìù <span id="saveNoteStatus"></span></label>
               <button id="btnSaveNoteManual" class="tiny-btn">üíæ Save Note</button>
            </div>
            <textarea id="userNoteArea" class="notes-textarea" placeholder="Type notes here..."></textarea>
          </div>

          <!-- Main Buttons -->
          <div class="btn-row-main">
            <button id="btnSubmit" class="primary-btn large">Submit</button>
            <button id="btnNext" class="primary-btn large hidden">Next ‚Üí</button>
            <label class="check-label guess-box">
              <input type="checkbox" id="guessCheck"> I'm Guessing
            </label>
          </div>

          <!-- SRS -->
          <div id="srsButtons" class="srs-row hidden">
            <button class="srs-btn again" id="btnSrsAgain">Again</button>
            <button class="srs-btn hard" id="btnSrsHard">Hard</button>
            <button class="srs-btn good" id="btnSrsGood">Good</button>
            <button class="srs-btn easy" id="btnSrsEasy">Easy</button>
          </div>

          <!-- Nav -->
          <div class="nav-row">
            <button id="btnPrev" class="secondary-btn">‚Üê Previous</button>
            <button id="btnExitFocus" class="danger-btn hidden" style="margin-left:auto;">Exit Focus</button>
          </div>
        </div>

        <!-- RIGHT SIDEBAR: NAVIGATOR -->
        <div class="col-side">
          <div class="card side-card">
            <div class="small-label">Session Stats</div>
            <div id="sessionStats">0 Correct</div>
          </div>
          <div class="card side-card">
            <div class="small-label">Session Navigator</div>
            <div id="historyList" class="history-list seq-nav"></div>
          </div>
        </div>

      </div>
    </section>

    <!-- LIBRARY -->
    <section id="tab-all" class="tab-content">
      <div class="card library-card">

        <div class="library-sticky-header">

          <div class="filter-bar">
            <input id="allSearch" class="std-input" placeholder="Search text, ID, tags‚Ä¶">
            
            <select id="allFilter" class="std-select">
              <option value="all">All</option>
              <option value="maintain">üîß Maintenance</option>
              <option value="notes">With Notes</option>
              <option value="wrong">Errors</option>
              <option value="flagged">Flagged</option>
            </select>

            <select id="allChapterSelect" class="std-select chapter-list">
               <option value="">All Chapters</option>
            </select>

            <button id="btnAllApply" class="refresh-btn">‚Üª Apply</button>
          </div>

          <!-- TOP ACTION BAR -->
          <div class="action-area">
            <div class="action-group">
              <button id="btnScanDup" class="pill-btn">üîç Check Duplicates</button>
              <span id="dupResult" class="muted small-label"></span>
              <button id="btnFixDup" class="danger-btn small hidden">Auto-Fix</button>
            </div>

            <div class="spacer"></div>

            <div class="action-group">
              <button id="btnRangeMode" class="pill-btn">‚ú® Range: OFF</button>
              <button id="btnBulkDelete" class="danger-btn">Delete Selected</button>
              
              <input type="file" id="fileInput" accept=".json" class="hidden">
              <button id="btnImportTrigger" class="secondary-btn">üì• Import</button>
              <button id="btnExportTrigger" class="secondary-btn">üíæ Export</button>
            </div>
          </div>
          
          <div id="dropZone" class="drop-zone hidden">Drop JSON Here</div>

        </div>

        <!-- TABLE -->
        <div class="table-wrapper">
          <table class="q-table">
            <thead>
              <tr>
                <th width="40"><input type="checkbox" id="allSelectAll"></th>
                <th class="sortable" data-key="id" width="60">ID ‚Üï</th>
                <th class="sortable" data-key="text" width="40%">Question ‚Üï</th>
                <th class="sortable" data-key="chapter" width="20%">Chapter ‚Üï</th>
                <th width="80">Tags</th>
                <th width="80">Stats</th>
                <th width="80">Status</th>
                <th width="50">Edit</th>
              </tr>
            </thead>
            <tbody id="allTableBody"></tbody>
          </table>
        </div>

        <div class="all-footer">
          <span id="selCount">0 Selected</span>
          <div class="pagination">
            <button id="allPrevPage" class="nav-btn">Prev</button>
            <span id="allPageInfo">1</span>
            <button id="allNextPage" class="nav-btn">Next</button>
          </div>
        </div>

      </div>
    </section>

    <!-- FLASHCARDS -->
    <section id="tab-flashcards" class="tab-content">
      <div class="card center-layout">
        <h3>Flashcards</h3>
        <div class="row-controls" style="justify-content:center;">
          <select id="fcSource" class="std-select">
            <option value="due">Due</option>
            <option value="all">All</option>
            <option value="weak">Weak</option>
            <option value="flagged">Flagged</option>
          </select>
          <button id="btnFcShuffle" class="primary-btn">Shuffle</button>
        </div>

        <div id="fcCard" class="flashcard">
          <div id="fcFront">Click Shuffle</div>
          <div id="fcBack" class="hidden"></div>
        </div>

        <div class="fc-actions">
          <button id="btnFcShow" class="secondary-btn">Show Answer</button>
          <div id="fcGrading" class="hidden">
            <button id="btnFcAgain" class="danger-btn">Again</button>
            <button id="btnFcGood" class="primary-btn">Good</button>
          </div>
        </div>
      </div>
    </section>

    <!-- EXAM -->
    <section id="tab-exam" class="tab-content">
      <div class="card">
        <h2>Exam Simulator</h2>
        <div class="row-controls">
          <select id="examChapterSelect" class="std-select chapter-list"><option value="">All</option></select>
          <input id="examCount" type="number" value="40" class="std-input" style="width:70px">
          <button id="btnStartExam" class="primary-btn">Start Exam</button>
        </div>
      </div>

      <div id="examInterface" class="card hidden">
        <div class="exam-header">
            Q <span id="examProgress">1</span>
            <span id="examTimer" class="timer-badge">00:00</span>
        </div>
        <div id="examQPanel" class="question-panel"></div>
        <div class="btn-row-main">
          <button id="btnExamNext" class="nav-btn">Next</button>
          <button id="btnExamFinish" class="danger-btn">Finish</button>
        </div>
      </div>

      <div id="examResults" class="card hidden">
        <h3>Results</h3>
        <div id="examScore"></div>
        <button id="btnExamClose" class="pill-btn">Close</button>
      </div>
    </section>

    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="tab-content">
      <div class="card">
        <h2>Statistics</h2>
        <div class="dashboard-grid">
          <div class="dash-box"><h3>Total</h3><span id="dashTotal" class="dash-val">0</span></div>
          <div class="dash-box"><h3>Maintenance</h3><span id="dashMaint" class="dash-val warning">0</span></div>
          <div class="dash-box"><h3>Mastery</h3><span id="dashMastery" class="dash-val">0%</span></div>
          <div class="dash-box"><h3>Velocity</h3><span id="dashVelocity" class="dash-val">0/day</span></div>
        </div>
        <div style="margin-top:20px; text-align:center;">
          <button id="btnRefreshStats" class="refresh-btn">‚Üª Refresh Stats</button>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="tab-settings" class="tab-content">
      <div class="card">
        <h3>GitHub Config</h3>
        <input id="ghToken" placeholder="Token" class="std-input" style="width:100%; margin-bottom:10px;">
        <input id="ghRepo" placeholder="User/Repo" class="std-input" style="width:100%; margin-bottom:10px;">
        <input id="ghFile" value="mcq_backup.json" class="std-input" style="width:100%; margin-bottom:10px;">

        <button id="btnSaveGh" class="primary-btn">Save Settings</button>
        <hr>
        <button id="btnCloudUpload" class="secondary-btn">Force Upload</button>
        <button id="btnCloudDownload" class="secondary-btn">Force Download</button>
        
        <div style="margin-top:15px;">
           <label class="small-label">Restore History (Last 10)</label>
           <select id="backupHistoryList" class="std-select" style="width:100%; margin-bottom:5px;">
              <option value="">No backups available</option>
           </select>
           <button id="btnRestoreBackup" class="secondary-btn">Restore Selected</button>
        </div>
      </div>

      <div class="card" style="margin-top:20px;">
        <h3>System</h3>
        <button id="btnResetProgress" class="danger-btn">Reset Stats</button>
        <button id="btnFactoryReset" class="danger-btn">Factory Reset</button>
        <button id="btnForceReload" class="ghost-btn">Force Reload</button>
      </div>
    </section>

    <!-- NEW: SESSIONS TAB -->
    <section id="tab-sessions" class="tab-content">
      <div class="card">
        <h2>Practice Sessions</h2>
        <div class="row-controls">
           <button id="btnNewSession" class="primary-btn">New Session</button>
           <button id="btnRefreshSessions" class="refresh-btn">‚Üª Refresh</button>
        </div>
        <div id="sessionsList" class="history-list" style="max-height:600px;"></div>
      </div>
    </section>

    <!-- NEW: QUESTION BACKUPS TAB -->
    <section id="tab-backups" class="tab-content">
      <div class="card">
         <h2>Question Backups (Local History)</h2>
         <button id="btnBackupNow" class="primary-btn">Create Backup Now</button>
         <div id="localBackupList" class="history-list" style="margin-top:15px;"></div>
      </div>
    </section>

  </main>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal hidden">
  <div class="modal-backdrop" id="editModalBackdrop"></div>
  <div class="modal-content">
    <h3>Edit Question</h3>
    <textarea id="editText" class="std-textarea" rows="3"></textarea>
    <div class="row-inputs">
      <input id="editChapter" class="std-input" placeholder="Chapter">
      <input id="editTags" class="std-input" placeholder="Tags">
    </div>
    
    <div class="maint-type-row">
       <label><input type="radio" name="editIssueType" value="none"> None</label>
       <label><input type="radio" name="editIssueType" value="maintenance"> Maintenance</label>
       <label><input type="radio" name="editIssueType" value="error"> Error</label>
    </div>
    <textarea id="editIssueNote" class="std-textarea" rows="2" placeholder="Issue Note..."></textarea>

    <textarea id="editExplanation" class="std-textarea" rows="3" placeholder="Explanation"></textarea>

    <div class="small-label">Choices:</div>
    <div id="editChoicesList"></div>
    <button id="btnAddChoice" class="pill-btn small" style="margin-top:5px;">+ Choice</button>

    <div class="modal-footer">
      <button id="btnSaveEdit" class="primary-btn">Save</button>
      <button id="btnCancelEdit" class="secondary-btn">Cancel</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>