<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MCQ Ultra-Pro v17 Practice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css?v=17.0.0">
</head>
<body>
<div class="app">
  <div class="top-bar">
    <div class="brand-area">
      <div class="logo">üß†</div>
      <div>
        <h1>MCQ Ultra‚ÄëPro ‚Äì ICU / IM</h1>
        <span class="ver">v17.0</span>
      </div>
      <div class="chip">Local DB</div>
      <div class="chip" id="dbStatus">DB: ‚Ä¶</div>
    </div>
    <div class="chips">
      <div class="xp-wrapper">Streak: <span id="streakCount">0</span> ‚Ä¢ XP: <span id="userXP">0</span></div>
      <button class="pill-btn" id="themeToggle">üåì Theme</button>
      <button class="header-btn" id="btnHeaderBackup">‚òÅ Backup</button>
    </div>
  </div>

  <div class="tabs">
    <button class="tab-button active" data-tab="practice">Practice</button>
    <button class="tab-button" data-tab="all">All Questions</button>
    <button class="tab-button" data-tab="flash">Flashcards</button>
    <button class="tab-button" data-tab="exam">Exam Sim</button>
    <button class="tab-button" data-tab="settings">Settings</button>
    <button class="tab-button" data-tab="dashboard">Dashboard</button>
  </div>

  <div class="tab-container">
    <!-- PRACTICE -->
    <div class="tab-content active" id="tab-practice">
      <div class="row">
        <div class="col-main">
          <div class="card">
            <div class="row-controls">
              <div>
                <span class="small-label">Mode</span>
                <select class="std-select" id="modeSelect">
                  <option value="due">Due / Mixed</option>
                  <option value="chapter">By Chapter</option>
                  <option value="wrong">Wrong Focus</option>
                  <option value="maintain">Maintenance Only</option>
                  <option value="flagged">Flagged Only</option>
                  <option value="new">New Only</option>
                </select>
              </div>
              <div id="chapterBox" style="display:none;">
                <span class="small-label">Chapter</span>
                <select class="std-select chapter-list" id="chapterSelect"></select>
              </div>
              <button class="refresh-btn" id="btnRefreshPractice">üîÑ Refresh / New Session</button>
            </div>

            <div id="questionPanel" class="question-panel">
              Loading question...
            </div>

            <div class="maint-box hidden" id="maintBox">
              <span class="small-label">Issue / Maintenance</span>
              <div class="maint-type-row">
                <label><input type="radio" name="maintType" value="maintenance"> Maintenance</label>
                <label><input type="radio" name="maintType" value="error"> Error</label>
                <label><input type="radio" name="maintType" value="none"> Clear</label>
              </div>
              <textarea id="maintNote" class="std-textarea" placeholder="Describe the problem..."></textarea>
              <div style="margin-top:8px; display:flex; gap:8px;">
                <button class="primary-btn tiny-btn" id="btnSaveMaint">Save</button>
                <button class="secondary-btn tiny-btn" id="btnMaintain">Close</button>
              </div>
            </div>

            <div id="feedbackPanel" class="feedback-panel hidden"></div>

            <div class="srs-row hidden" id="srsButtons">
              <button class="srs-btn again" onclick="handleSRS(1)">Again</button>
              <button class="srs-btn hard" onclick="handleSRS(2)">Hard</button>
              <button class="srs-btn good" onclick="handleSRS(3)">Good</button>
              <button class="srs-btn easy" onclick="handleSRS(4)">Easy</button>
            </div>

            <div class="row" style="margin-top:15px; align-items:center;">
              <div class="col-main">
                <span class="small-label">Personal Note for this Question</span>
                <textarea id="userNoteArea" class="notes-textarea" placeholder="Add your own note, rationale, or memory hook..."></textarea>
                <div id="saveNoteStatus" style="font-size:0.75rem; margin-top:4px;"></div>
              </div>
              <div class="col-side" style="display:flex; flex-direction:column; gap:6px; align-items:flex-end; justify-content:flex-end;">
                <button class="secondary-btn tiny-btn" id="btnSaveNoteManual">üíæ Save Note</button>
                <button class="pill-btn tiny-btn" id="btnFlag">Flag ‚öê</button>
                <button class="pill-btn tiny-btn" id="btnMaintain">üîß Issue</button>
              </div>
            </div>

            <div class="row" style="margin-top:15px; align-items:center;">
              <div style="display:flex; gap:10px; align-items:center;">
                <button class="primary-btn" id="btnSubmit">Submit</button>
                <button class="primary-btn" id="btnNext">Next ‚Üí</button>
                <button class="secondary-btn" id="btnPrev">‚Üê Previous</button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-side">
          <div class="card side-card">
            <div class="small-label">Session</div>
            <div id="sessionStats" class="stats-text">0 Seen ‚Ä¢ 0 Correct</div>
          </div>
          <div class="card side-card">
            <div class="small-label">History / Sequence</div>
            <div class="history-list" id="historyList"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ALL QUESTIONS -->
    <div class="tab-content" id="tab-all">
      <div class="library-card">
        <div class="library-sticky-header">
          <div class="row-controls">
            <div class="flex-grow">
              <span class="small-label">Search</span>
              <input id="allSearch" class="std-input" placeholder="Text or exact ID...">
            </div>
            <div>
              <span class="small-label">Filter</span>
              <select class="std-select" id="allFilter">
                <option value="all">All</option>
                <option value="maintain">Maintenance</option>
                <option value="notes">With Notes</option>
                <option value="error">Errors</option>
                <option value="flagged">Flagged</option>
              </select>
            </div>
            <div>
              <span class="small-label">Chapter</span>
              <select class="std-select chapter-list" id="allChapterSelect"></select>
            </div>
            <div>
              <span class="small-label">Date From</span>
              <input type="date" class="std-input date-input" id="allDateFrom">
            </div>
            <div>
              <span class="small-label">Time From</span>
              <input type="time" class="std-input time-input" id="allTimeFrom">
            </div>
            <div>
              <span class="small-label">Date To</span>
              <input type="date" class="std-input date-input" id="allDateTo">
            </div>
            <div>
              <span class="small-label">Time To</span>
              <input type="time" class="std-input time-input" id="allTimeTo">
            </div>
            <button class="primary-btn" id="btnAllApply">Apply</button>
          </div>
        </div>

        <div class="table-wrapper">
          <table class="q-table">
            <thead>
              <tr>
                <th style="width:40px;"><input type="checkbox" id="allSelectAll"></th>
                <th class="sortable" data-key="id">ID</th>
                <th class="sortable" data-key="text">Question</th>
                <th class="sortable" data-key="chapter">Chapter</th>
                <th>User Note</th>
                <th>Issue Note</th>
                <th>Status</th>
                <th>Edit</th>
              </tr>
            </thead>
            <tbody id="allTableBody"></tbody>
          </table>
        </div>

        <div class="library-sticky-header" style="border-top:1px solid var(--border);">
          <div class="action-area">
            <div class="action-group">
              <button class="pill-btn" id="btnRangeMode">‚ú® Range: OFF</button>
              <span style="font-size:0.8rem; opacity:0.7;">Multi-select between first & last clicked</span>
            </div>
            <div class="action-group">
              <button class="danger-btn tiny-btn" id="btnBulkDelete">Delete</button>
            </div>
            <div class="spacer"></div>
            <div class="action-group">
              <button class="pill-btn tiny-btn" id="btnImportTrigger">‚¨Ü Import JSON</button>
              <button class="pill-btn tiny-btn" id="btnExportTrigger">‚¨á Export JSON</button>
              <input type="file" id="fileInput" accept=".json" style="display:none;">
            </div>
            <div class="action-group">
              <button class="pill-btn tiny-btn" id="btnScanDup">üîç Dups</button>
              <button class="pill-btn tiny-btn hidden" id="btnFixDup">üßπ Fix</button>
              <span id="dupResult" style="font-size:0.8rem;"></span>
            </div>
            <div class="action-group">
              <button class="pill-btn tiny-btn" id="allPrevPage">Prev</button>
              <span id="allPageInfo">1</span>
              <button class="pill-btn tiny-btn" id="allNextPage">Next</button>
            </div>
            <div class="action-group">
              <span id="selCount" style="font-size:0.8rem;">0 Selected</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- FLASHCARDS -->
    <div class="tab-content" id="tab-flash">
      <div class="card">
        <h2>Flashcards</h2>
        <p style="font-size:0.9rem; opacity:0.8;">Quick recall mode using your existing questions.</p>
        <div class="flashcard">
          <div id="fcFront"></div>
          <div id="fcBack" class="hidden"></div>
        </div>
        <div class="fc-actions">
          <button class="secondary-btn" id="btnFcShuffle">Shuffle</button>
          <button class="primary-btn" id="btnFcShow">Show Answer</button>
        </div>
        <div class="fc-actions" id="fcGrading" class="hidden">
          <button class="danger-btn" id="btnFcAgain">Again</button>
          <button class="primary-btn" id="btnFcGood">Good</button>
        </div>
      </div>
    </div>

    <!-- EXAM SIM -->
    <div class="tab-content" id="tab-exam">
      <div class="card">
        <h2>Exam Simulation</h2>
        <div class="row-controls">
          <div>
            <span class="small-label">Number of Questions</span>
            <input id="examCount" class="std-input" type="number" value="40" min="5" max="200">
          </div>
          <button class="primary-btn" id="btnStartExam">Start Exam</button>
        </div>
        <div id="examInterface" class="hidden">
          <div id="examProgress"></div>
          <div id="examQPanel" style="margin-top:10px;"></div>
          <div style="margin-top:15px; display:flex; gap:10px;">
            <button class="secondary-btn" id="btnExamNext">Next</button>
            <button class="primary-btn" id="btnExamFinish">Finish</button>
          </div>
        </div>
        <div id="examResults" class="hidden" style="margin-top:20px;">
          <div id="examScore"></div>
          <button class="secondary-btn" id="btnExamClose">Close</button>
        </div>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="tab-content" id="tab-settings">
      <div class="card">
        <h2>Backup & Cloud (GitHub)</h2>
        <div class="row-controls">
          <div class="flex-grow">
            <span class="small-label">Token</span>
            <input id="ghToken" class="std-input" placeholder="GitHub PAT (classic, repo scope)">
          </div>
          <div class="flex-grow">
            <span class="small-label">Repo (user/repo)</span>
            <input id="ghRepo" class="std-input" placeholder="user/repo">
          </div>
          <div>
            <span class="small-label">Base Filename</span>
            <input id="ghFile" class="std-input" value="mcq_backup">
          </div>
        </div>
        <div class="row-controls">
          <button class="primary-btn" id="btnSaveGh">Save Settings</button>
          <button class="pill-btn" id="btnCloudUpload">‚òÅ Upload Now</button>
          <button class="pill-btn" id="btnCloudDownload">‚¨á Download Latest</button>
          <select id="ghBackupList" class="std-select" style="min-width:200px;"></select>
          <button class="pill-btn" id="btnCloudDownloadSelected">Download Selected</button>
        </div>
        <div style="margin-top:10px; font-size:0.85rem;">
          <span id="syncStatus" class="warning-text">Cloud: Not Linked</span>
        </div>
      </div>

      <div class="card">
        <h2>Reset & Factory</h2>
        <p style="font-size:0.85rem; color:#b91c1c;">Use with care. Make local backup before resetting.</p>
        <div class="row-controls">
          <button class="danger-btn" id="btnResetDetails">Reset Details (by filter/selection)</button>
          <button class="pill-btn hidden" id="btnUndoReset">Undo Reset (5 sec)</button>
          <button class="pill-btn" id="btnResetProgress">Reset All Progress</button>
          <button class="danger-btn" id="btnFactoryReset">Full Factory Reset</button>
        </div>
      </div>
    </div>

    <!-- DASHBOARD -->
    <div class="tab-content" id="tab-dashboard">
      <div class="card">
        <h2>Overview</h2>
        <div class="dashboard-grid">
          <div class="dash-box">
            <div class="small-label">Total Questions</div>
            <div class="dash-val" id="dashTotal">0</div>
          </div>
          <div class="dash-box">
            <div class="small-label">Mastery (‚â•4 correct)</div>
            <div class="dash-val" id="dashMastery">0%</div>
          </div>
          <div class="dash-box">
            <div class="small-label">Maintenance Issues</div>
            <div class="dash-val warning" id="dashMaint">0</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="toastContainer" class="toast-container"></div>

<!-- EDIT MODAL -->
<div id="editModal" class="modal hidden">
  <div class="modal-content">
    <h2>Edit Question</h2>
    <div class="row-controls">
      <div class="flex-grow">
        <span class="small-label">Text</span>
        <textarea id="editText" class="std-textarea" style="min-height:80px;"></textarea>
      </div>
      <div>
        <span class="small-label">Chapter</span>
        <input id="editChapter" class="std-input">
      </div>
    </div>
    <div class="row-controls">
      <div class="flex-grow">
        <span class="small-label">Tags</span>
        <input id="editTags" class="std-input">
      </div>
      <div class="flex-grow">
        <span class="small-label">Issue Type</span>
        <div>
          <label><input type="radio" name="editIssueType" value="none" checked> None</label>
          <label><input type="radio" name="editIssueType" value="maintenance"> Maintenance</label>
          <label><input type="radio" name="editIssueType" value="error"> Error</label>
        </div>
      </div>
    </div>
    <div class="row-controls">
      <div class="flex-grow">
        <span class="small-label">Explanation</span>
        <textarea id="editExplanation" class="std-textarea" style="min-height:60px;"></textarea>
      </div>
      <div class="flex-grow">
        <span class="small-label">Issue Note</span>
        <textarea id="editIssueNote" class="std-textarea" style="min-height:60px;"></textarea>
      </div>
    </div>
    <div>
      <span class="small-label">Choices</span>
      <div id="editChoicesList"></div>
      <button class="pill-btn tiny-btn" id="btnAddChoice">+ Choice</button>
    </div>
    <div style="margin-top:15px; display:flex; justify-content:flex-end; gap:10px;">
      <button class="secondary-btn" id="btnCancelEdit">Cancel</button>
      <button class="primary-btn" id="btnSaveEdit">Save</button>
    </div>
  </div>
</div>

<script src="app.js?v=17.0.0"></script>
</body>
</html>