<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MCQ Ultra-Pro v9.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#2563eb">
  <link rel="manifest" href="manifest.json?v=9.0.0">
  <link rel="stylesheet" href="style.css?v=9.0.0">
</head>
<body>

<div id="toastContainer" class="toast-container"></div>

<div class="app" id="appRoot">
  
  <header class="top-bar">
    <div class="brand-area">
      <h1>MCQ Ultra-Pro <span class="ver">v9.0 Safety</span></h1>
      <div class="xp-container">
        <span id="userRank" class="rank-badge">Resident</span>
        <div class="xp-bar-bg"><div id="xpBarFill" class="xp-bar-fill" style="width:0%"></div></div>
        <span class="xp-val"><span id="currXP">0</span> XP</span>
      </div>
    </div>
    <div class="chips">
      <button id="btnTimeMachine" class="chip chip-time" title="Restore History">üï∞Ô∏è Time Machine</button>
      <span class="chip" id="syncStatus">‚òÅÔ∏è Offline</span>
      <select id="themeSelect" class="chip chip-theme">
        <option value="system">üíª System</option>
        <option value="light">‚òÄÔ∏é Light</option>
        <option value="dark">üåô Dark</option>
      </select>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-button active" data-tab="home">Practice</button>
    <button class="tab-button" data-tab="library">Library</button>
    <button class="tab-button" data-tab="collections">Collections</button>
    <button class="tab-button" data-tab="exam">Sim</button>
    <button class="tab-button" data-tab="dashboard">Stats</button>
    <button class="tab-button" data-tab="backup">Backup</button>
    <button class="tab-button" data-tab="settings">Config</button>
  </nav>

  <main class="tab-container">

    <section class="tab-content active" id="tab-home">
      <div class="card">
        <div class="row">
          <div class="col-main">
            <div class="row-controls">
              <div>
                <label class="small-label">Source</label>
                <select id="modeSelect" class="std-select">
                  <option value="due">Smart Review (SRS)</option>
                  <option value="new">New Questions</option>
                  <option value="wrong">Mistakes</option>
                  <option value="chapter">Specific Chapter</option>
                  <option value="collection">My Collections</option>
                </select>
                <select id="chapterSelect" class="std-select chapter-list" style="display:none;">
                  <option value="">Select Chapter...</option>
                </select>
              </div>
              
              <div class="toggles">
                 <label class="check-label">
                   <input type="checkbox" id="prefSkipSolved" checked> Skip Solved
                 </label>
              </div>

              <div class="all-actions">
                 <button class="pill-btn" id="btnTTS" title="Read Question">üîä Speak</button>
              </div>
            </div>

            <div id="questionPanel" class="question-panel"></div>
            
            <div id="highlighterTools" class="tools-bar hidden">
               <span class="tiny muted">Highlight Mode Active</span>
               <button class="color-dot yellow" onclick="setHighlight('yellow')"></button>
               <button class="color-dot green" onclick="setHighlight('green')"></button>
               <button class="color-dot pink" onclick="setHighlight('pink')"></button>
               <button class="pill-btn small" onclick="clearHighlights()">Clear</button>
            </div>

            <div class="notes-area-container">
              <label class="small-label">My Clinical Notes üìù</label>
              <textarea id="userNoteArea" class="notes-textarea" placeholder="Add a pearl..."></textarea>
              <div id="saveNoteStatus" class="save-status"></div>
            </div>

            <div id="feedbackPanel" class="feedback-panel hidden"></div>

            <div class="btn-row-main">
              <button class="primary-btn" id="btnSubmit">Submit Answer</button>
              <label class="check-label" style="margin-left:15px;">
                <input type="checkbox" id="guessCheck"> Guessing
              </label>
              <button id="btnHighlight" class="ghost-btn">üñçÔ∏è Highlight</button>
            </div>
            
            <div class="nav-row">
               <button class="nav-btn" id="btnPrev">Previous</button>
               <button class="nav-btn" id="btnNext">Next</button>
               <button class="ghost-btn" id="btnFlag">Flag üö©</button>
            </div>
          </div>
          
          <div class="col-side">
             <div class="card side-card">
               <div class="small-label">Timer</div>
               <div id="qTimer" class="timer-box">00s</div>
             </div>
             <div class="card side-card">
               <div class="small-label">Tools</div>
               <div id="searchTools" class="v-stack"></div>
             </div>
          </div>
        </div>
      </div>
    </section>

    <section class="tab-content" id="tab-library">
      <div class="subnav">
         <button class="subnav-btn active" id="viewLib">Question Bank</button>
         <button class="subnav-btn" id="viewTags">Tag Manager</button>
         <button class="subnav-btn" id="viewBuilder">AI Builder</button>
      </div>

      <div id="libBankView">
        <div class="card">
           <div class="row-controls">
              <input id="allSearch" placeholder="Global Search (Press /)" class="std-input search-box">
              <select id="allFilter" class="std-select">
                <option value="all">All</option>
                <option value="wrong">Errors</option>
                <option value="notes">Has Notes</option>
                <option value="unseen">Unseen</option>
              </select>
              <button id="btnAllApply" class="primary-btn">Apply</button>
           </div>
           
           <div class="bulk-strip">
              <button id="btnRangeMode" class="pill-btn">‚ú® Range Select</button>
              <div class="bulk-actions">
                 <button id="btnBulkDelete" class="danger-btn small">Delete</button>
                 <button id="btnBulkCollection" class="action-btn small">Add to Collection</button>
              </div>
           </div>

           <div class="table-wrapper">
             <table class="q-table">
               <thead>
                 <tr>
                   <th width="30"><input type="checkbox" id="allSelectAll"></th>
                   <th class="sortable" data-sort="id" width="50">ID</th>
                   <th class="sortable" data-sort="text">Question</th>
                   <th class="sortable" data-sort="chapter" width="120">Chapter</th>
                   <th class="sortable" data-sort="timesWrong" width="50">Err</th>
                   <th width="50">Edit</th>
                 </tr>
               </thead>
               <tbody id="allTableBody"></tbody>
             </table>
           </div>
           <div class="all-footer">
              <button id="allPrevPage" class="nav-btn">Prev</button>
              <span id="allPageInfo">1/1</span>
              <button id="allNextPage" class="nav-btn">Next</button>
           </div>
        </div>
      </div>

      <div id="libTagView" class="hidden">
         <div class="card">
            <h3>Tag Manager</h3>
            <p class="muted tiny">Rename or merge tags across all questions.</p>
            <div id="tagList" class="tag-grid"></div>
         </div>
      </div>

      <div id="libBuilderView" class="hidden">
         <div class="card">
            <div class="builder-layout">
               <div class="b-col">
                  <label>Source Text</label>
                  <textarea id="builderSource" rows="8" class="std-textarea"></textarea>
                  <button id="btnGenPrompt" class="action-btn">Generate Prompt</button>
                  <textarea id="builderPrompt" rows="4" class="std-textarea" readonly></textarea>
               </div>
               <div class="b-col">
                  <label>Paste JSON</label>
                  <textarea id="builderJson" rows="8" class="std-textarea"></textarea>
                  <button id="btnImportJson" class="primary-btn">Import & Auto-Fix</button>
               </div>
            </div>
         </div>
      </div>
    </section>

    <section class="tab-content" id="tab-collections">
       <div class="card">
          <h2>My Collections</h2>
          <div class="row-controls">
             <input id="newCollName" placeholder="New Collection Name" class="std-input">
             <button id="btnCreateColl" class="primary-btn">Create</button>
          </div>
          <div id="collectionsList" class="coll-grid">
             <div class="empty-state">No collections yet. Create one to group questions.</div>
          </div>
       </div>
    </section>

    <section class="tab-content" id="tab-exam">
       <div class="card center-box">
          <h2>Exam Simulator</h2>
          <div class="exam-config">
             <select id="examChapter" class="std-select chapter-list"><option value="">All</option></select>
             <input id="examQty" type="number" value="40" class="std-input" style="width:80px">
             <button id="btnStartExam" class="primary-btn">Start Block</button>
          </div>
       </div>
       <div id="examUI" class="card hidden">
          <div class="exam-header">
             <span id="examProgress">0/0</span>
             <span id="examTime" class="timer-red">00:00</span>
          </div>
          <div id="examPanel" class="q-panel"></div>
          <div class="nav-row">
             <button id="btnExamPrev" class="nav-btn">Prev</button>
             <button id="btnExamNext" class="nav-btn">Next</button>
             <button id="btnExamSubmit" class="danger-btn">Finish</button>
          </div>
       </div>
    </section>

    <section class="tab-content" id="tab-dashboard">
       <div class="dashboard-grid">
          <div class="dash-card">
             <h3>Total</h3>
             <div class="big-num" id="dTotal">0</div>
          </div>
          <div class="dash-card">
             <h3>Mastery</h3>
             <div class="big-num" id="dMastery">0%</div>
          </div>
          <div class="dash-card">
             <h3>Streak</h3>
             <div class="big-num" id="dStreak">0 üî•</div>
          </div>
       </div>
       <div class="card" style="margin-top:20px;">
          <h3>Chapter Performance</h3>
          <div id="chapterStats" class="bars-list"></div>
       </div>
    </section>

    <section class="tab-content" id="tab-backup">
      <div class="card warning-border">
         <h2>Cloud Sync (GitHub)</h2>
         <div class="sync-status-box">
            Status: <strong id="ghStatusText">Not Configured</strong>
         </div>
         <div class="row-controls">
            <button id="btnCloudUpload" class="action-btn">‚¨Ü Upload to Cloud</button>
            <button id="btnCloudDownload" class="action-btn">‚¨á Download from Cloud</button>
         </div>
         <p class="tiny danger-text">Safety Lock: Upload is blocked if local database is empty.</p>
      </div>
      
      <div class="card">
         <h2>Local & History</h2>
         <div class="row-controls">
            <button id="btnLocalExport" class="secondary-btn">Export JSON</button>
            <input type="file" id="fileInput" class="hidden">
            <button id="btnLocalImport" class="secondary-btn">Import JSON</button>
         </div>
      </div>
    </section>

    <section class="tab-content" id="tab-settings">
       <div class="card">
          <h3>GitHub Config</h3>
          <div class="settings-grid">
             <input type="password" id="ghToken" placeholder="Token" class="std-input">
             <input id="ghRepo" placeholder="User/Repo" class="std-input">
             <button id="btnSaveGh" class="primary-btn">Save</button>
          </div>
       </div>
       <div class="card">
          <h3>Reset</h3>
          <button id="btnResetAll" class="danger-btn">Factory Reset</button>
       </div>
    </section>

  </main>
</div>

<div id="modalTimeMachine" class="modal hidden">
   <div class="modal-content">
      <h3>üï∞Ô∏è Time Machine</h3>
      <p class="tiny">Restore your database from a previous auto-save point.</p>
      <div id="snapshotList" class="snap-list"></div>
      <button class="secondary-btn" onclick="closeModal('modalTimeMachine')">Close</button>
   </div>
</div>

<div id="modalEdit" class="modal hidden">
   <div class="modal-content large">
      <h3>Edit Question</h3>
      <textarea id="edtText" class="std-textarea" rows="2"></textarea>
      <div class="row-inputs">
         <input id="edtChapter" placeholder="Chapter" class="std-input">
         <input id="edtTags" placeholder="Tags" class="std-input">
      </div>
      <textarea id="edtExpl" class="std-textarea" rows="3"></textarea>
      <div id="edtChoices"></div>
      <div class="modal-footer">
         <button id="btnSaveEdit" class="primary-btn">Save</button>
         <button class="secondary-btn" onclick="closeModal('modalEdit')">Cancel</button>
      </div>
   </div>
</div>

<script src="app.js?v=9.0.0"></script>
</body>
</html>
