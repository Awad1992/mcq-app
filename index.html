<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MCQ Ultra-Pro V20</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#2563eb">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:,">
</head>

<body>
<div id="toastContainer" class="toast-container"></div>

<div class="app" id="appRoot">

  <!-- TOP BAR -->
  <header class="top-bar">
    <div class="brand-area">
      <div class="logo">üíé</div>
      <div>
        <h1>MCQ Ultra-Pro <span class="ver">V20</span></h1>
        <div class="xp-wrapper">
          <span id="userRank">Intern</span> ‚Ä¢ 
          <span id="userXP">0</span> XP ‚Ä¢ 
          üî• <span id="streakCount">0</span>
        </div>
      </div>
    </div>

    <div class="chips">
      <span class="chip" id="dbStatus">DB: Init...</span>
      <span class="chip chip-sync" id="syncStatus">Cloud: Check</span>
      <button id="btnHeaderBackup" class="chip header-btn">‚òÅÔ∏è Backup</button>
      <button id="themeToggle" class="chip header-btn">üåó Theme</button>
    </div>
  </header>

  <!-- NAV -->
  <nav class="tabs">
    <button class="tab-button active" data-tab="home">Practice</button>
    <button class="tab-button" data-tab="all">Library</button>
    <button class="tab-button" data-tab="flashcards">Flashcards</button>
    <button class="tab-button" data-tab="exam">Exam</button>
    <button class="tab-button" data-tab="dashboard">Stats</button>
    <button class="tab-button" data-tab="settings">Settings</button>
    <button class="tab-button" data-tab="sessions">Sessions</button>
    <button class="tab-button" data-tab="backups">Question Backups</button>
  </nav>

  <!-- MAIN -->
  <main class="tab-container">

    <!-- PRACTICE -->
    <section id="tab-home" class="tab-content active">
      <div class="card main-layout">

        <div class="row-controls">

          <select id="modeSelect" class="std-select">
            <option value="due">üß† Smart Review</option>
            <option value="new">üÜï New Only</option>
            <option value="wrong">‚ùå Mistakes</option>
            <option value="maintain">üîß Maintenance</option>
            <option value="flagged">üö© Flagged</option>
            <option value="chapter">üìÇ By Chapter</option>
            <option value="all">üîÄ Random All</option>
          </select>

          <div id="chapterBox" style="display:none;">
            <select id="chapterSelect" class="std-select chapter-list"></select>
          </div>

          <button id="btnRefreshPractice" class="refresh-btn">‚Üª Apply</button>

          <label class="check-label">
            <input type="checkbox" id="prefSkipSolved"> Skip Mastered
          </label>

          <button id="btnFocusMode" class="pill-btn">üßò Focus</button>
        </div>

        <div id="qInfoBar" class="info-bar hidden">
          <span id="qInfoID"></span> ‚Ä¢ 
          <span id="qInfoChapter"></span> ‚Ä¢
          <span id="qInfoStats"></span> ‚Ä¢
          <span id="qInfoDate"></span>
        </div>

        <!-- QUESTION PANEL -->
        <div id="questionPanel" class="question-panel">
          <div class="muted" style="text-align:center; padding:20px;">
            Loading Engine‚Ä¶
          </div>
        </div>

        <!-- FEEDBACK -->
        <div id="feedbackPanel" class="feedback-panel hidden"></div>

        <!-- NOTES -->
        <div class="notes-container">
          <label class="small-label">Notes üìù <span id="saveNoteStatus"></span></label>
          <textarea id="userNoteArea" class="notes-textarea"></textarea>
          <button id="btnSaveNoteManual" class="tiny-btn">üíæ Save</button>
        </div>

        <!-- BUTTONS -->
        <div class="btn-row-main">
          <button id="btnSubmit" class="primary-btn large">Submit</button>
          <button id="btnNext" class="primary-btn large hidden">Next ‚Üí</button>
          <label class="check-label guess-box">
            <input type="checkbox" id="guessCheck"> I'm Guessing
          </label>
        </div>

        <!-- SRS -->
        <div id="srsButtons" class="srs-row hidden">
          <button class="srs-btn again" id="btnSrsAgain">Again</button>
          <button class="srs-btn hard" id="btnSrsHard">Hard</button>
          <button class="srs-btn good" id="btnSrsGood">Good</button>
          <button class="srs-btn easy" id="btnSrsEasy">Easy</button>
        </div>

        <!-- NAV -->
        <div class="nav-row">
          <button id="btnPrev" class="secondary-btn">‚Üê Previous</button>
          <button id="btnExitFocus" class="danger-btn hidden" style="margin-left:auto;">Exit Focus</button>
        </div>

        <!-- SESSION SIDE -->
        <div class="card side-card">
          <div class="small-label">Session Stats</div>
          <div id="sessionStats">0 Correct</div>
        </div>
        <div class="card side-card">
          <div class="small-label">Session Questions</div>
          <div id="historyList" class="history-list"></div>
        </div>
      </div>
    </section>

    <!-- LIBRARY -->
    <section id="tab-all" class="tab-content">
      <div class="card library-card">

        <div class="library-sticky-header">

          <div class="filter-bar">
            <input id="allSearch" class="std-input" placeholder="Search‚Ä¶">
            <select id="allFilter" class="std-select">
              <option value="all">All</option>
              <option value="maintain">Maintenance</option>
              <option value="notes">With Notes</option>
              <option value="wrong">Errors</option>
              <option value="flagged">Flagged</option>
              <option value="duplicate">Duplicates</option>
              <option value="weak">Weak</option>
              <option value="inactive">Inactive</option>
            </select>

            <select id="allChapterSelect" class="std-select chapter-list"></select>

            <input type="date" id="allDateFrom" class="std-input date-input">
            <input type="date" id="allDateTo" class="std-input date-input">

            <button id="btnAllApply" class="refresh-btn">‚Üª Apply</button>
          </div>

          <div class="action-area">
            <div class="action-group">
              <button id="btnScanDup" class="pill-btn">üîç Check Duplicates</button>
              <span id="dupResult" class="muted small-label"></span>
              <button id="btnFixDup" class="danger-btn small hidden">Auto-Fix</button>
            </div>

            <div class="spacer"></div>

            <div class="action-group">
              <label class="check-label"><input type="checkbox" id="allRangeMode"> Range Select</label>
              <button id="btnBulkDelete" class="danger-btn">Delete Selected</button>
              <input type="file" id="fileInput" accept=".json" class="hidden">
              <button id="btnImportTrigger" class="secondary-btn">üì• Import</button>
              <button id="btnExportTrigger" class="secondary-btn">üíæ Export</button>
            </div>
          </div>

          <div id="dropZone" class="drop-zone hidden">
            Drop JSON here
          </div>

        </div>

        <!-- TABLE -->
        <div class="table-wrapper">
          <table class="q-table">
            <thead>
              <tr>
                <th><input type="checkbox" id="allSelectAll"></th>
                <th>ID</th>
                <th>Date</th>
                <th>Question</th>
                <th>Chapter</th>
                <th>Tags</th>
                <th>Stats</th>
                <th>Status</th>
                <th>Edit</th>
              </tr>
            </thead>
            <tbody id="allTableBody"></tbody>
          </table>
        </div>

        <div class="all-footer">
          <span id="selCount">0 Selected</span>
          <div class="pagination">
            <button id="allPrevPage" class="nav-btn">Prev</button>
            <span id="allPageInfo">1</span>
            <button id="allNextPage" class="nav-btn">Next</button>
          </div>
        </div>

      </div>
    </section>

    <!-- FLASHCARDS -->
    <section id="tab-flashcards" class="tab-content">
      <div class="card center-layout">
        <h3>Flashcards</h3>
        <select id="fcSource" class="std-select">
          <option value="due">Due</option>
          <option value="all">All</option>
          <option value="weak">Weak</option>
          <option value="flagged">Flagged</option>
          <option value="chapter">By Chapter</option>
        </select>
        <select id="fcChapterFilter" class="std-select chapter-list" style="display:none;"></select>
        <select id="fcMode" class="std-select">
          <option value="q-first">Q ‚Üí A</option>
          <option value="a-first">A ‚Üí Q</option>
        </select>

        <button id="btnFcShuffle" class="primary-btn">Shuffle</button>

        <div id="fcCard" class="flashcard">
          <div id="flashcardFront">Front</div>
          <div id="flashcardBack" class="hidden">Back</div>
        </div>

        <div class="btn-row">
          <button id="btnFcShow" class="secondary-btn">Show</button>
          <button id="btnFcNext" class="primary-btn">Next</button>
        </div>

        <div id="fcGrading" class="hidden">
          <button id="btnFcAgain" class="danger-btn">Again</button>
          <button id="btnFcGood" class="primary-btn">Good</button>
        </div>
      </div>
    </section>

    <!-- EXAM -->
    <section id="tab-exam" class="tab-content">
      <div class="card">
        <h3>Exam Simulator</h3>

        <select id="examPool" class="std-select">
          <option value="all">All</option>
          <option value="weak">Weak</option>
          <option value="flagged">Flagged</option>
          <option value="chapter">By Chapter</option>
        </select>
        <select id="examChapterFilter" class="std-select chapter-list" style="display:none;"></select>

        <input type="number" id="examCount" class="std-input" value="40" style="width:70px;">
        <input type="number" id="examMinutes" class="std-input" value="60" style="width:70px;">
        <button id="btnStartExam" class="primary-btn">Start</button>

        <div id="examActiveCard" class="card hidden" style="margin-top:12px;">
          <div class="exam-header">
            Q <span id="examIndexLabel">1</span>/<span id="examTotalLabel">0</span>
            <span style="margin-left:auto;">‚è± <span id="examTimerLabel">00:00</span></span>
          </div>
          <div id="examQuestionPanel" class="question-panel"></div>

          <div class="btn-row">
            <button id="btnExamPrev" class="nav-btn">Prev</button>
            <button id="btnExamNext" class="nav-btn">Next</button>
            <button id="btnExamFinish" class="danger-btn">Finish</button>
          </div>
        </div>

        <div id="examResultCard" class="card hidden" style="margin-top:12px;">
          <h3>Results</h3>
          <div id="examSummary"></div>
          <div id="examDetails" style="margin-top:8px;"></div>
        </div>
      </div>
    </section>

    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="tab-content">
      <div class="card">
        <h2>Statistics</h2>
        <div id="statsBar" class="stats-bar"></div>

        <div class="dashboard-grid">
          <div class="dash-box"><h3>Overall</h3><div id="dashOverall"></div></div>
          <div class="dash-box"><h3>Weak Chapters</h3><div id="dashWeakChapters"></div></div>
          <div class="dash-box"><h3>Weekly</h3><div id="dashWeekly"></div></div>
        </div>

        <button id="btnRefreshStats" class="refresh-btn" style="margin-top:20px;">‚Üª Refresh</button>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="tab-settings" class="tab-content">
      <div class="card">
        <h3>GitHub Config</h3>

        <input id="ghToken" class="std-input" placeholder="Token">
        <input id="ghRepo" class="std-input" placeholder="User/Repo">
        <input id="ghFile" class="std-input" value="mcq_backup.json">

        <button id="btnSaveGh" class="primary-btn">Save</button>

        <hr>

        <button id="btnCloudUpload" class="secondary-btn">Upload</button>
        <button id="btnCloudDownload" class="secondary-btn">Download</button>

        <div id="cloudInfo" class="muted tiny" style="margin-top:8px;"></div>
        <div class="tiny muted" style="margin-top:8px;">Last activity: <span id="lastActivityLabel">‚Äì</span></div>
        <div class="tiny muted">Last backup: <span id="lastBackupLabel">‚Äì</span></div>
      </div>

      <div class="card" style="margin-top:20px;">
        <h3>System</h3>
        <select id="resetScope" class="std-select">
          <option value="all">All</option>
          <option value="wrong">Wrong only</option>
        </select>
        <button id="btnResetProgress" class="danger-btn">Reset Stats</button>
        <button id="btnFactoryReset" class="danger-btn">Factory Reset</button>
        <button id="btnForceReload" class="ghost-btn">Force Reload</button>
      </div>
    </section>

    <!-- SESSIONS -->
    <section id="tab-sessions" class="tab-content">
      <div class="card">
        <h3>Practice Sessions</h3>
        <button id="btnNewSession" class="primary-btn">New Session</button>
        <button id="btnSessions" class="secondary-btn">Show Sessions</button>
        <div id="sessionsList" style="margin-top:12px;"></div>
      </div>
    </section>

    <!-- QUESTION BACKUPS PAGE -->
    <section id="tab-backups" class="tab-content">
      <div class="card">
        <h3>Question Backups</h3>

        <button id="btnBackupQuestionsNow" class="primary-btn">Backup Now</button>
        <input type="file" id="backupFileInput" accept=".json" class="hidden">
        <button id="btnBackupImport" class="secondary-btn">Import Backup</button>
        <button id="btnBackupExport" class="secondary-btn">Export Backup</button>

        <div id="questionsBackupsTable" style="margin-top:20px;"></div>
      </div>
    </section>

  </main>
</div>

<!-- EDIT MODAL -->
<div id="editModal" class="modal hidden">
  <div class="modal-backdrop" id="editModalBackdrop"></div>
  <div class="modal-content">
    <h3 id="editModalTitle">Edit Question</h3>

    <textarea id="editText" class="std-textarea" rows="3" placeholder="Question text"></textarea>

    <div class="row-inputs">
      <input id="editChapter" class="std-input" placeholder="Chapter">
      <input id="editTags" class="std-input" placeholder="Tags (comma separated)">
    </div>

    <label class="check-label warning-text">
      <input type="checkbox" id="editMaint"> Maintenance
    </label>
    <label class="check-label warning-text">
      <input type="checkbox" id="editFlagged"> Flagged
    </label>
    <label class="check-label warning-text">
      <input type="checkbox" id="editPinned"> Pinned
    </label>
    <label class="check-label warning-text">
      <input type="checkbox" id="editActive" checked> Active
    </label>

    <textarea id="editExplanation" class="std-textarea" rows="3" placeholder="Explanation"></textarea>

    <div class="small-label">Image</div>
    <input id="editImageUrl" class="std-input" placeholder="Image URL">
    <input id="editImageFile" type="file" accept="image/*" class="std-input">
    <div id="editImagePreview" class="img-preview"></div>

    <div class="small-label">Choices</div>
    <div id="editChoices"></div>
    <button id="btnAddChoice" class="pill-btn small">+ Choice</button>

    <div class="modal-footer">
      <button id="btnEditSave" class="primary-btn">Save</button>
      <button id="btnEditCancel" class="secondary-btn">Cancel</button>
    </div>
  </div>
</div>

<!-- SESSIONS MODAL -->
<div id="sessionsModal" class="modal hidden">
  <div class="modal-backdrop" id="sessionsModalBackdrop"></div>
  <div class="modal-content">
    <h3>Sessions</h3>
    <div id="sessionsModalList"></div>
    <div class="modal-footer">
      <button id="btnCloseSessions" class="secondary-btn">Close</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
