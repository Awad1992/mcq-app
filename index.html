<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MCQ Legendary v6.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" href="style.css?v=6.0.1">
</head>
<body>

<div id="toastContainer" class="toast-container"></div>

<div class="app" id="appRoot">
  
  <header class="top-bar">
    <div class="brand">
      <h1>MCQ Legendary <span class="ver">v6.0</span></h1>
      <div class="subtitle">The Complete Medical Study Engine</div>
    </div>
    <div class="chips">
      <span class="chip">DB: Online</span>
      <span class="chip chip-sync" id="syncStatus">Cloud: Idle</span>
      <button id="themeToggle" class="chip chip-theme">üåó Theme</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-button active" data-tab="home">Practice</button>
    <button class="tab-button" data-tab="all">Data Center (All Qs)</button>
    <button class="tab-button" data-tab="flashcards">Flashcards</button>
    <button class="tab-button" data-tab="exam">Exam Sim</button>
    <button class="tab-button" data-tab="dashboard">Stats</button>
    <button class="tab-button" data-tab="settings">Settings & Cloud</button>
  </nav>

  <main class="tab-container">

    <section class="tab-content active" id="tab-home">
      <div class="card">
        <div class="row">
          <div class="col-main">
            <div class="row-controls">
              <div>
                <label class="small-label">Source</label>
                <select id="modeSelect" class="control-input">
                  <option value="due">Spaced Repetition (Smart)</option>
                  <option value="all">Random Shuffle</option>
                  <option value="new">Unseen Only</option>
                  <option value="wrong">Mistakes History</option>
                  <option value="flagged">Flagged Only</option>
                  <option value="chapter">Specific Chapter</option>
                </select>
                <select id="chapterSelect" class="control-input" style="display:none; max-width:150px;">
                  <option value="">All Chapters</option>
                </select>
              </div>
              
              <div style="display:flex; align-items:center; gap:10px; margin-top:15px;">
                 <label class="check-label">
                   <input type="checkbox" id="prefSkipSolved" checked> Skip Mastered
                 </label>
              </div>

              <div class="all-actions">
                 <button id="btnFocusMode" class="pill-btn">üßò Focus</button>
              </div>
            </div>

            <div id="questionPanel" class="question-panel"></div>
            
            <div class="tools-bar">
               <div id="searchTools"></div>
               <button id="btnFlag" class="ghost-btn">Flag üö©</button>
            </div>

            <div class="notes-box">
              <label class="small-label">Clinical Notes üìù</label>
              <textarea id="userNoteArea" class="notes-input" placeholder="Add note..."></textarea>
              <span id="saveNoteStatus" class="save-status"></span>
            </div>

            <div id="feedbackPanel" class="feedback-panel hidden"></div>

            <div class="action-bar">
              <button class="primary-btn" id="btnSubmit">Submit (Enter)</button>
              <label class="check-label" style="margin-left:10px;">
                <input type="checkbox" id="guessCheck"> Guess
              </label>
              <button id="btnExitFocus" class="danger-btn hidden" style="margin-left:auto;">Exit Focus</button>
            </div>
            
            <div class="nav-bar">
               <button class="nav-btn" id="btnPrev">‚Üê Prev</button>
               <button class="nav-btn" id="btnNext">Next ‚Üí</button>
            </div>
          </div>

          <div class="col-side">
            <div class="card side-box">
               <div class="small-label">Session Stats</div>
               <div id="sessionStats">0 Correct / 0 Wrong</div>
            </div>
            <div class="card side-box">
               <div class="small-label">Recent History</div>
               <div class="history-list" id="historyList"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="tab-content" id="tab-all">
      <div class="subnav">
        <button class="subnav-btn active" id="viewBankBtn">Question Bank</button>
        <button class="subnav-btn" id="viewBuilderBtn">AI Builder</button>
      </div>

      <div id="allViewBank">
        <div class="card">
          <div class="filter-bar">
             <input id="allSearch" placeholder="Search text, ID, tags..." class="filter-input">
             <select id="allFilter" class="filter-input">
               <option value="all">Status: All</option>
               <option value="notes">Has Notes</option>
               <option value="wrong">Has Errors</option>
               <option value="flagged">Flagged</option>
               <option value="unseen">Unseen</option>
             </select>
             <select id="allChapterSelect" class="filter-input chapter-list">
               <option value="">Chapter: All</option>
             </select>
             <button id="btnAllApply" class="action-btn">Apply Filter</button>
          </div>

          <div id="bulkActionsBar" class="bulk-bar hidden">
             <span id="selectedCountLabel">0 Selected</span>
             <div class="bulk-tools">
               <button id="btnBulkDelete" class="danger-btn small">Delete</button>
               <button id="btnBulkFlag" class="action-btn small">Flag/Unflag</button>
               <button id="btnBulkReset" class="action-btn small">Reset Stats</button>
               <button id="btnBulkChapter" class="action-btn small">Move Chapter</button>
             </div>
          </div>

          <div class="table-container">
            <table class="pro-table">
              <thead>
                <tr>
                  <th width="30"><input type="checkbox" id="allSelectAll"></th>
                  <th class="sortable" data-sort="id" width="60">ID ‚Üï</th>
                  <th class="sortable" data-sort="text">Question ‚Üï</th>
                  <th class="sortable" data-sort="chapter" width="120">Chapter ‚Üï</th>
                  <th class="sortable" data-sort="timesSeen" width="50">View ‚Üï</th>
                  <th class="sortable" data-sort="timesWrong" width="50">Err ‚Üï</th>
                  <th width="60">Action</th>
                </tr>
              </thead>
              <tbody id="allTableBody"></tbody>
            </table>
          </div>
          
          <div class="pagination">
             <button id="allPrevPage" class="page-btn">Previous</button>
             <span id="allPageInfo">Page 1</span>
             <button id="allNextPage" class="page-btn">Next</button>
          </div>
          
          <div class="io-bar">
            <div class="io-group">
              <input type="file" id="fileInput" accept=".json" class="hidden">
              <button id="btnImportTrigger" class="secondary-btn">üìÇ Import JSON</button>
              <button id="btnExportTrigger" class="secondary-btn">üíæ Export JSON</button>
            </div>
            <div class="io-group">
              <button id="btnRangeMode" class="pill-btn">‚ú® Range Select</button>
            </div>
          </div>
        </div>
      </div>

      <div id="allViewBuilder" class="hidden">
         <div class="card builder-card">
           <h3>AI Question Generator</h3>
           <div class="split-view">
             <div class="split-col">
               <label>1. Paste Source Text</label>
               <textarea id="builderSourceText" placeholder="Paste content here..."></textarea>
               <div class="builder-controls">
                 <input id="builderNumQuestions" type="number" value="10">
                 <button id="btnBuilderMakePrompt" class="primary-btn">Generate Prompt</button>
               </div>
               <textarea id="builderPromptOut" readonly placeholder="Prompt will appear here. Copy to ChatGPT/Gemini."></textarea>
             </div>
             <div class="split-col">
               <label>2. Paste AI Response (JSON)</label>
               <textarea id="builderJsonInput" placeholder="Paste the JSON array here..."></textarea>
               <div class="builder-controls">
                 <button id="btnBuilderPreview" class="action-btn">Preview</button>
                 <button id="btnBuilderImportSelected" class="primary-btn">Import Questions</button>
               </div>
               <div id="builderPreview" class="preview-box"></div>
             </div>
           </div>
         </div>
      </div>
    </section>

    <section class="tab-content" id="tab-flashcards">
       <div class="card center-card">
         <div class="fc-controls">
           <select id="fcSource"><option value="due">Due</option><option value="weak">Weak</option></select>
           <select id="fcMode"><option value="q">Q ‚Üí A</option><option value="a">A ‚Üí Q</option></select>
           <button id="btnFcShuffle" class="action-btn">Shuffle</button>
         </div>
         <div class="flashcard">
            <div id="fcFront" class="fc-face">Empty</div>
            <div id="fcBack" class="fc-face hidden"></div>
         </div>
         <div class="fc-actions">
            <button id="btnFcShow" class="primary-btn">Show Answer (Space)</button>
            <div id="fcGrading" class="hidden">
               <button class="grade-btn bad" onclick="gradeCard(1)">Hard</button>
               <button class="grade-btn good" onclick="gradeCard(3)">Good</button>
               <button class="grade-btn easy" onclick="gradeCard(5)">Easy</button>
            </div>
         </div>
       </div>
    </section>

    <section class="tab-content" id="tab-exam">
      <div class="card">
        <div class="exam-setup">
           <h2>Exam Simulator</h2>
           <div class="setup-row">
             <select id="examChapterSelect" class="chapter-list"><option value="">All Chapters</option></select>
             <input id="examCount" type="number" value="50" placeholder="Qty">
             <button id="btnStartExam" class="primary-btn">Start Exam</button>
           </div>
        </div>
        
        <div id="examInterface" class="hidden">
           <div class="exam-hud">
             <span id="examProgress">Q 1/50</span>
             <span id="examTimer">00:00</span>
           </div>
           <div id="examQPanel" class="q-panel"></div>
           <div class="exam-nav">
             <button id="btnExamPrev">Prev</button>
             <button id="btnExamNext">Next</button>
             <button id="btnExamFinish" class="danger-btn">Finish</button>
           </div>
        </div>

        <div id="examResults" class="hidden">
           <h3>Results</h3>
           <div id="examScore"></div>
           <button id="btnExamClose" class="action-btn">Close</button>
        </div>
      </div>
    </section>

    <section class="tab-content" id="tab-dashboard">
       <div class="dashboard-grid">
          <div class="stat-box">
             <h3>Total Questions</h3>
             <span id="dashTotal" class="big-num">0</span>
          </div>
          <div class="stat-box">
             <h3>Mastery</h3>
             <span id="dashMastery" class="big-num">0%</span>
          </div>
          <div class="stat-box">
             <h3>Weakest Chapter</h3>
             <span id="dashWeakest" class="med-text">-</span>
          </div>
       </div>
    </section>

    <section class="tab-content" id="tab-settings">
      <div class="card">
        <h3>GitHub Sync</h3>
        <div class="settings-row">
           <input type="password" id="ghToken" placeholder="Token (ghp_...)">
           <input id="ghRepo" placeholder="User/Repo">
           <button id="btnSaveGh" class="primary-btn">Save Config</button>
        </div>
        <div class="cloud-actions">
           <button id="btnUpload" class="action-btn">‚¨Ü Upload</button>
           <button id="btnDownload" class="action-btn">‚¨á Download</button>
        </div>
      </div>
      
      <div class="card">
        <h3>Data Management</h3>
        <button id="btnResetProgress" class="danger-btn">Reset All Progress</button>
        <button id="btnForceReload" class="ghost-btn">Force App Reload</button>
      </div>
    </section>

  </main>
</div>

<div id="editModal" class="modal hidden">
  <div class="modal-content">
     <h3>Edit Question</h3>
     <textarea id="editText" class="full-text" rows="3"></textarea>
     <div class="row-inputs">
       <input id="editChapter" placeholder="Chapter">
       <input id="editTags" placeholder="Tags">
     </div>
     <textarea id="editExplanation" class="full-text" rows="3" placeholder="Explanation"></textarea>
     <div id="editChoicesList"></div>
     <div class="modal-footer">
        <button id="btnSaveEdit" class="primary-btn">Save</button>
        <button id="btnCancelEdit" class="secondary-btn">Cancel</button>
     </div>
  </div>
</div>

<script src="app.js?v=6.0.1"></script>
</body>
</html>
